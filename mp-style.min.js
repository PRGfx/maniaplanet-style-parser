"use strict";function MPStyle(s,e){var t=function(){var s="",e={color:null,isBold:!1,isCapitalized:!1,isItalic:!1,isNarrow:!1,isWide:!1,isLink:null,isShadowed:!1,link:null};return{content:s,getContent:function(){return s},styles:function(s){if(void 0!==s){for(var t in e)void 0!==s[t]&&(e[t]=s[t]);return this}return e},append:function(e){return s+=e,this},copy:function(){var s=new t;return s.styles(e),s}}};e={mlProtocol:e&&e.mlProtocol?e.mlProtocol:"maniaplanet://",stripTags:e&&e.stripTags?e.stripTags:[],useClasses:e&&e.useClasses?e.useClasses:!1};var i=[new t],n=!1,r=[0],l=function(s){i[i.length-1].append(s)},a=function(s){var e=i[i.length-1].copy().styles(s);i.push(e),r[r.length-1]++},o=function(s){for(var o=0;o<s.length;o++){var c=s.charAt(o).toLowerCase();if("$"==c)n?(l(c),n=!1):n=!0;else{if(!n){l(s.charAt(o));continue}var p=i[r[r.length-1]].styles();switch(c){case"o":e.stripTags.indexOf("o")<0&&a({isBold:!p.isBold});break;case"i":e.stripTags.indexOf("i")<0&&a({isItalic:!p.isItalic});break;case"g":a({color:null});break;case"z":i.push(new t),r[r.length-1]++;break;case"t":e.stripTags.indexOf("t")<0&&a({isCapitalized:!p.isCapitalized});break;case"h":case"l":case"p":if(null===p.isLink){var u=null;if("["==s.charAt(o+1)){for(var h=o+1;h<s.length;h++)if("]"==s.charAt(h)){u=s.substr(o+2,h-o-2);break}o+=u.length+2}e.stripTags.indexOf(c)<0&&a({isLink:c,link:u})}else a({isLink:null,link:null});break;case"<":i.push(i[i.length-1].copy()),r.push(i.length-1);break;case">":r.pop(),i.push(i[r[r.length-1]].copy()),r[r.length-1]=i.length-1}s.substr(o,3).match(/[0-9a-f]{3}/i)&&(e.stripTags.indexOf("color")<0&&a({color:s.substr(o,3)}),o+=2),n=!1}}},c=function(){for(var s=function(s,e,t){var i=s,n=e||{},r=t||"",l=function(s){if(!(s||Object.keys(n).length>0))return r;s=!0;var t="<"+i;for(var l in n)e.hasOwnProperty(l)&&e[l]&&(t+=" "+l+'="'+e[l]+'"');return t+=">"+r+"</"+i+">"};return{render:l}},t="",n=0;n<i.length;n++){var r=i[n];if(r.getContent()){var l=r.getContent(),a=r.styles();if(a.isLink){var o=a.link?a.link:l;("h"==a.isLink||"p"==a.isLink)&&(o.startsWith(e.mlProtocol)||(o=e.mlProtocol+o));var c={href:o};e.useClasses&&(c["class"]="mp-link mp-link-"+a.isLink),l=new s("a",c,l).render()}var p="",u=[];a.isBold&&(p+="font-weight:bold;",u.push("mp-bold")),a.isItalic&&(p+="font-style:italic;",u.push("mp-italic")),a.color&&(p+="color:#"+a.color+";",u.push("mp-color")),a.isShadowed&&(p+="text-shadow:1px 1px 1px rgba(0, 0, 0, 0.5);",u.push("mp-shadow")),a.isNarrow&&(p+="letter-spacing:-.1em;font-size:95%;",u.push("mp-narrow")),a.isWide&&(p+="letter-spacing:.1em;font-size:105%;",u.push("mp-wide")),a.isCapitalized&&(p+="text-transform: uppercase;",u.push("mp-upper"));var h={};p&&(e.useClasses?a.color&&(h.style="color:#"+a.color+";"):h.style=p),e.useClasses&&u.length&&(h["class"]=u.join(" ")),l=new s("span",h,l).render(),t+=l}}return t};return o(s),c()}