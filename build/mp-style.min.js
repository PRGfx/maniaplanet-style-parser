!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.MPStyle=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function MPStyle(input,options){var TextBlock=function(){var content="",styles={color:null,isBold:!1,isCapitalized:!1,isItalic:!1,isNarrow:!1,isWide:!1,isLink:null,isShadowed:!1,link:null};return{content:content,getContent:function(){return content},styles:function(s){if(void 0!==s){for(var style in styles)void 0!==s[style]&&(styles[style]=s[style]);return this}return styles},append:function(c){return content+=c,this},copy:function(){var s=new TextBlock;return s.styles(styles),s}}};options={mlProtocol:options&&options.mlProtocol?options.mlProtocol:"maniaplanet://",stripTags:options&&options.stripTags?options.stripTags:[],useClasses:!(!options||!options.useClasses)&&options.useClasses};var blocks=[new TextBlock],escaped=!1,formatBlocks=[0],append=function(c){blocks[blocks.length-1].append(c)},setStyle=function(style){var nb=blocks[blocks.length-1].copy().styles(style);blocks.push(nb),formatBlocks[formatBlocks.length-1]++},parse=function(input){for(var i=0;i<input.length;i++){var c=input.charAt(i).toLowerCase();if("$"==c)escaped?(append(c),escaped=!1):escaped=!0;else{if(!escaped){append(input.charAt(i));continue}var cs=blocks[formatBlocks[formatBlocks.length-1]].styles();switch(c){case"o":options.stripTags.indexOf("o")<0&&setStyle({isBold:!cs.isBold});break;case"i":options.stripTags.indexOf("i")<0&&setStyle({isItalic:!cs.isItalic});break;case"g":setStyle({color:null});break;case"z":blocks.push(formatBlocks.length<2?new TextBlock:blocks[formatBlocks[formatBlocks.length-2]].copy()),formatBlocks[formatBlocks.length-1]++;break;case"t":options.stripTags.indexOf("t")<0&&setStyle({isCapitalized:!cs.isCapitalized});break;case"h":case"l":case"p":if(null===cs.isLink){var href=null;if("["==input.charAt(i+1)){for(var j=i+1;j<input.length;j++)if("]"==input.charAt(j)){href=input.substr(i+2,j-i-2);break}i+=href.length+2}options.stripTags.indexOf(c)<0&&setStyle({isLink:c,link:href})}else setStyle({isLink:null,link:null});break;case"<":blocks.push(blocks[blocks.length-1].copy()),formatBlocks.push(blocks.length-1);break;case">":formatBlocks.pop(),blocks.push(blocks[formatBlocks[formatBlocks.length-1]].copy()),formatBlocks[formatBlocks.length-1]=blocks.length-1}input.substr(i,3).match(/[0-9a-f]{3}/i)&&(options.stripTags.indexOf("color")<0&&setStyle({color:input.substr(i,3)}),i+=2),escaped=!1}}},render=function(){for(var Tag=function(type,attributes,content){var t=type,a=attributes||{},c=content||"",render=function(forceTag){if(!(forceTag||Object.keys(a).length>0))return c;forceTag=!0;var output="<"+t;for(var attr in a)attributes.hasOwnProperty(attr)&&attributes[attr]&&(output+=" "+attr+'="'+attributes[attr]+'"');return output+=">"+c+"</"+t+">"};return{render:render}},output="",i=0;i<blocks.length;i++){var block=blocks[i];if(block.getContent()){var content=block.getContent(),style=block.styles();if(style.isLink){var href=style.link?style.link:content;"h"!=style.isLink&&"p"!=style.isLink||href.startsWith(options.mlProtocol)||(href=options.mlProtocol+href);var attr={href:href};options.useClasses&&(attr.class="mp-link mp-link-"+style.isLink),content=new Tag("a",attr,content).render()}var cssStyle="",classes=[];style.isBold&&(cssStyle+="font-weight:bold;",classes.push("mp-bold")),style.isItalic&&(cssStyle+="font-style:italic;",classes.push("mp-italic")),style.color&&(cssStyle+="color:#"+style.color+";",classes.push("mp-color")),style.isShadowed&&(cssStyle+="text-shadow:1px 1px 1px rgba(0, 0, 0, 0.5);",classes.push("mp-shadow")),style.isNarrow&&(cssStyle+="letter-spacing:-.1em;font-size:95%;",classes.push("mp-narrow")),style.isWide&&(cssStyle+="letter-spacing:.1em;font-size:105%;",classes.push("mp-wide")),style.isCapitalized&&(cssStyle+="text-transform: uppercase;",classes.push("mp-upper"));var attributes={};cssStyle&&(options.useClasses?style.color&&(attributes.style="color:#"+style.color+";"):attributes.style=cssStyle),options.useClasses&&classes.length&&(attributes.class=classes.join(" ")),content=new Tag("span",attributes,content).render(),output+=content}}return output};return parse(input),render()}module.exports=MPStyle},{}]},{},[1])(1)});
